<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>docker:watch | docker-maven-plugin</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.4">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./docker-push.html" />
    
    
    <link rel="prev" href="./docker-stop.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="4.4"
        data-chapter-title="docker:watch"
        data-filepath="docker-watch.md"
        data-basepath="."
        data-revision="Wed Dec 02 2015 16:40:05 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="installation.html">
            
                
                    <a href="./installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Installation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="global-configuration.html">
            
                
                    <a href="./global-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Global Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="image-configuration.html">
            
                
                    <a href="./image-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Image Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="goals.html">
            
                
                    <a href="./goals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Maven Goals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="docker-build.html">
            
                
                    <a href="./docker-build.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        docker:build
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="docker-start.html">
            
                
                    <a href="./docker-start.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        docker:start
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="docker-stop.html">
            
                
                    <a href="./docker-stop.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        docker:stop
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="4.4" data-path="docker-watch.html">
            
                
                    <a href="./docker-watch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        docker:watch
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="docker-push.html">
            
                
                    <a href="./docker-push.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        docker:push
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="docker-remove.html">
            
                
                    <a href="./docker-remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        docker:remove
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="docker-logs.html">
            
                
                    <a href="./docker-logs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        docker:logs
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="external-configuration.html">
            
                
                    <a href="./external-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        External Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="registry-handling.html">
            
                
                    <a href="./registry-handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Registry Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="authentication.html">
            
                
                    <a href="./authentication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="links.html">
            
                
                    <a href="./links.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Further Reading
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >docker-maven-plugin</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h3 id="dockerwatch"><a name="dockerwatch" class="plugin-anchor" href="#dockerwatch"><span class="fa fa-link"></span></a>docker:watch</h3>
<p>When developing and testing applications you will often have to
rebuild Docker images and restart containers. Typing <code>docker:build</code>
and <code>docker:start</code> all the time is cumbersome. With <code>docker:watch</code> you
can enable automatic rebuilding of images and restarting of containers
in case of updates.</p>
<p><code>docker:watch</code> is the top-level goal which perform these tasks. There
are two watch modes, which can be specified in multiple ways:</p>
<ul>
<li><p><code>build</code> : Automatically rebuild one or more Docker images when one
of the files selected by an assembly changes. This works for all files
included directly in <code>assembly.xml</code> but also for arbitrary dependencies. 
For example:</p>
<pre><code>  $ mvn package docker:build docker:watch -Ddocker.watchMode=build
</code></pre><p>This mode works only when there is a <code>&lt;build&gt;</code> section
in an image configuration. Otherwise no automatically build will be triggered for an 
image with only a <code>&lt;run&gt;</code> section. Note that you need the <code>package</code> phase to be executed before
otherwise any artifact created by this build can not be included
into the assembly. As described in the section about <code>docker:start</code> this
is a Maven limitation. </p>
</li>
<li><p><code>run</code> : Automatically restart container when their associated images
changes. This is useful if you pull a new version of an image
externally or especially in combination with the <code>build</code> mode to
restart containers when their image has been automatically
rebuilt. This mode works reliably only when used together with
<code>docker:start</code>.</p>
<pre><code>  $ mvn docker:start docker:watch -Ddocker.watchMode=run
</code></pre></li>
<li><p><code>both</code> : Enables both <code>build</code> and <code>run</code>. This is the default <code>both</code>. </p>
</li>
<li><p><code>none</code> : Image is complete ignored for watching</p>
</li>
<li><p><code>copy</code> : Copy changed files into the running container. This is the
fast way to update a container, however the target container must
support hot deply, too so that it makes sense. Most application
servers like Tomcat supports this. </p>
</li>
</ul>
<p>The mode can also be <code>both</code> or <code>none</code> to select both or none of these
variants, respectively. The default is <code>both</code>. </p>
<p><code>docker:watch</code> will run forever until it is interrupted with <code>CTRL-C</code>
after which it will stop all containers. Depending on the configuration
parameters <code>keepContainer</code> and <code>removeVolumes</code> the stopped containers
with their volumes will be removed, too.</p>
<p>When an image is removed while watching it, error messages will be printed out
periodically.  So don&apos;t do that ;-)</p>
<p>Dynamically assigned ports stay stable in that they won&apos;t change after
a container has been stopped and a new container is created and started. The new
container will try to allocate the same ports as the previous container.</p>
<p>If containers are linked together network or volume wise, and you
update a container which other containers dependent on, the dependant
containers are not restarted for now. E.g. when you have a &quot;service&quot;
container accessing a &quot;db&quot; container and the &quot;db&quot; container is
updated, then you &quot;service&quot; container will fail until it is restarted,
too. A future version of this plugin will take care of restarting
these containers, too (in the right order), but for now you would have
to do this manually.</p>
<p>This maven goal can be configured with the following top-level
parameters:</p>
<ul>
<li><strong>watchMode</strong> <code>docker.watchMode</code>: The watch mode specifies what should be watched<ul>
<li><code>build</code> : Watch changes in the assembly and rebuild the image in
case</li>
<li><code>run</code> : Watch a container&apos;s image whether it changes and restart
the container in case</li>
<li><code>copy</code> : Changed files are copied into the container. The
container can be either running or might be already exited (when
used as a <em>data container</em> linked into a <em>platform
container</em>). Requires Docker &gt;= 1.8.</li>
<li><code>both</code> : <code>build</code> and <code>run</code> combined</li>
<li><code>none</code> : Neither watching for builds nor images. This is useful if
you use prefactored images which won&apos;t be changed and hence don&apos;t
need any watching. <code>none</code> is best used on an per image level, see
below how this can be specified.</li>
</ul>
</li>
<li><strong>watchInterval</strong> <code>docker.watchInterval</code> specifies the interval in
milliseconds how  often to check for changes, which must be larger
than 100ms. The default is 5 seconds.</li>
<li><strong>watchPostGoal</strong> A maven goal which should be called if a rebuild
or a restart has been performed. This goal must have the format
<code>&lt;pluginGroupId&gt;:&lt;pluginArtifactId&gt;:&lt;goal&gt;</code> and the plugin must be
configured in the <code>pom.xml</code>. For example a post-goal
<code>io.fabric8:fabric8:delete-pods</code> will trigger the deletion of PODs
in Kubernetes which in turn triggers are new start of a POD within
the Kubernetes cluster. The value specified here is the the default
post goal which can be overridden by <code>&lt;postGoal&gt;</code> in a <code>&lt;watch&gt;</code>
configuration.</li>
<li><strong>watchPostExec</strong> can be a command which is executed within the
container after files are copied into this container for <code>watchMode
== copy</code>. Note that this container must be running.</li>
<li><strong>keepRunning</strong> <code>docker.keepRunning</code> if set to <code>true</code> all
container will be kept running after <code>docker:watch</code> has been
stopped. By default this is set to <code>false</code>. </li>
<li><strong>keepContainer</strong> <code>docker.keepContainer</code> similar to <code>docker:stop</code>,
if this is set to <code>true</code> (and <code>keepRunning</code> is disabled) then all
container will be removed after they have been stopped. The default
is <code>true</code>.</li>
<li><strong>removeVolumes</strong> <code>docker.removeVolumes</code> if given will remove any
volumes associated to the container as well. This option will be ignored
if either <code>keepContainer</code> or <code>keepRunning</code> are <code>true</code>.</li>
</ul>
<p>Image specific watch configuration goes into an extra image-level
<code>&lt;watch&gt;</code> section (i.e. <code>&lt;image&gt;&lt;watch&gt;...&lt;/watch&gt;&lt;/image&gt;</code>). 
The following parameters are recognized:</p>
<ul>
<li><strong>mode</strong> Each image can be configured for having individual watch
mode. These take precedence of the global watch mode. The mode
specified in this configuration takes precedence over the globally
specified mode.</li>
<li><strong>interval</strong> The watch interval can be specified in milliseconds on
image level. If given this will override the global watch interval.</li>
<li><strong>postGoal</strong> A post Maven plugin goal after a rebuild or
restart. The value here must have the format
<code>&lt;pluginGroupId&gt;:&lt;pluginArtifactId&gt;:&lt;goal&gt;</code>
(e.g. <code>io.fabric8:fabric8:delete-pods</code>)</li>
<li><strong>postExec</strong> Command to execute after files are copied into a
running container for <code>mode == copy</code>. </li>
</ul>
<p>Here is an example how the watch mode can be tuned:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- Check every 10 seconds by default --&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">watchInterval</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-title">watchInterval</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- Watch for doing rebuilds and restarts --&gt;</span> 
   <span class="hljs-tag">&lt;<span class="hljs-title">watchMode</span>&gt;</span>both<span class="hljs-tag">&lt;/<span class="hljs-title">watch</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">images</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">image</span>&gt;</span>
         <span class="hljs-comment">&lt;!-- Service checks every 5 seconds --&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">alias</span>&gt;</span>service<span class="hljs-tag">&lt;/<span class="hljs-title">alias</span>&gt;</span>
         ....
         <span class="hljs-tag">&lt;<span class="hljs-title">watch</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">interval</span>&gt;</span>5000<span class="hljs-tag">&lt;/<span class="hljs-title">interval</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">watch</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">image</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">image</span>&gt;</span>
         <span class="hljs-comment">&lt;!-- Database needs no watching --&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">alias</span>&gt;</span>db<span class="hljs-tag">&lt;<span class="hljs-title">alias</span>&gt;</span>
         ....
         <span class="hljs-tag">&lt;<span class="hljs-title">watch</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">mode</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-title">mode</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">watch</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">image</span>&gt;</span>
      ....   
   <span class="hljs-tag">&lt;/<span class="hljs-title">images</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
</code></pre>
<p>Given this configuration </p>
<pre><code class="lang-sh">mvn package docker:build docker:start docker:watch
</code></pre>
<p>you can build the service image, start up all containers and go into a watch
loop. Again, you need the <code>package</code> phase in order that the assembly
can find the artifact build by this project. This is a Maven
limitation. The <code>db</code> image will never be watch since it assumed to not change 
while watching. </p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./docker-stop.html" class="navigation navigation-prev " aria-label="Previous page: docker:stop"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./docker-push.html" class="navigation navigation-next " aria-label="Next page: docker:push"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/rhuss/docker-maven-plugin/edit/master/doc/manual","label":"Edit This Page"},"anchors":{},"code_tomorrow_scheme":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
