<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>docker:start | docker-maven-plugin</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-edit-link/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="./docker-stop.html" />
    
    
    <link rel="prev" href="./docker-build.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="4.2" data-basepath="." data-revision="Fri Oct 16 2015 09:25:42 GMT+0000 (UTC)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="installation.html">
            
                
                    <a href="./installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Installation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="global-configuration.html">
            
                
                    <a href="./global-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Global Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="image-configuration.html">
            
                
                    <a href="./image-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Image Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="goals.html">
            
                
                    <a href="./goals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Maven Goals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="docker-build.html">
            
                
                    <a href="./docker-build.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        docker:build
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="4.2" data-path="docker-start.html">
            
                
                    <a href="./docker-start.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        docker:start
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="docker-stop.html">
            
                
                    <a href="./docker-stop.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        docker:stop
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="docker-watch.html">
            
                
                    <a href="./docker-watch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        docker:watch
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="docker-push.html">
            
                
                    <a href="./docker-push.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        docker:push
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="docker-remove.html">
            
                
                    <a href="./docker-remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        docker:remove
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="docker-logs.html">
            
                
                    <a href="./docker-logs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        docker:logs
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="external-configuration.html">
            
                
                    <a href="./external-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        External Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="registry-handling.html">
            
                
                    <a href="./registry-handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Registry Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="authentication.html">
            
                
                    <a href="./authentication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="links.html">
            
                
                    <a href="./links.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Further Reading
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >docker-maven-plugin</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <a id="edit-link" href="https://github.com/rhuss/docker-maven-plugin/edit/master/doc/manual/docker-start.md" class="btn fa fa-edit pull-left">&#xA0;&#xA0;Edit This Page</a><h3 id="docker-start"><a name="docker-start" class="plugin-anchor" href="#docker-start"><span class="fa fa-link"></span></a>docker:start</h3>
<p>Creates and starts docker containers. This goals evaluates
the configuration&apos;s <code>&lt;run&gt;</code> section of all given (and enabled images). In order to switch on 
globally the logs <strong>showLogs</strong> can be used as global configuration (i.e. outside of <code>&lt;images&gt;</code>).
If set it will print out all standard output and standard error messages for all containers started. 
As value the images for which logs should be shown can be given as a comma separated list. This is probably most 
useful when used from the command line as system property <code>docker.showLogs</code>.   </p>
<p>Also you can specify <code>docker.follow</code> as system property so that the <code>docker:start</code> will never return but block until
CTRL-C is pressed. That similar to the option <code>-i</code> for <code>docker run</code>. This will automatically switch on <code>showLogs</code> so that 
 you can see what is happening within the container. Also, after stopping with CTRL-C, the container is stopped (but 
 not removed so that you can make postmortem analysis).</p>
<p>The <code>&lt;run&gt;</code> configuration knows the following sub elements:</p>
<ul>
<li><strong>capAdd</strong> (<em>v1.14</em>) a list of <code>add</code> elements to specify kernel parameters to add to
the container.</li>
<li><strong>capDrop</strong> (<em>v1.14</em>) a list of <code>drop</code> elements to specify kernel parameters to remove
from the container.</li>
<li><strong>cmd</strong> is a command which should be executed at the end of the
container&apos;s startup. If not given, the image&apos;s default command is
used. See <a href="#start-up-arguments">Start-up Arguments</a> for details.</li>
<li><strong>domainname</strong> (<em>v1.12</em>) domain name for the container</li>
<li><strong>dns</strong> (<em>v1.11</em>) list of <code>host</code> elements specifying dns servers for the container to use</li>
<li><strong>dnsSearch</strong> (<em>v1.15</em>) list of <code>host</code> elements specying dns search domains </li>
<li><strong>entrypoint</strong> (<em>v1.15</em>) set the entry point for the container. See <a href="#start-up-arguments">Start-up Arguments</a> for details.</li>
<li><strong>env</strong> can contain environment variables as subelements which are
set during startup of the container. They are specified in the
typical maven property format as described <a href="#setting-environment-variables-and-labels">below</a>.</li>
<li><strong>labels</strong> specifies one or more labels which should be attached to the container. They are specified in the
typical maven property format as described <a href="#setting-environment-variables-and-labels">below</a>.</li>
<li><strong>envPropertyFile</strong> can be a path to a property file holding environment variables. If given, the variables
specified in this property file overrides the environment variables specified in the configuration.</li>
<li><strong>extraHosts</strong> (<em>v1.15</em>) list of <code>host</code> elements in the form <code>host:ip</code> to add to the container&apos;s <code>/etc/hosts</code> file. 
Additionally, you may specify a <code>host</code> element in the form <code>host:host</code> to have the right side host ip address resolved 
at container startup.</li>
<li><strong>hostname</strong> (<em>v1.11</em>) desired hostname for the container</li>
<li><strong>links</strong> declares how containers are linked together see
description on <a href="#container-linking">container linking</a>. </li>
<li><strong>log</strong> specifies the log configuration for whether and how log
messages from the running containers should be printed. See
<a href="#log-configuration">below</a> for a detailed description of this configuration
section. </li>
<li><strong>memory</strong> (<em>v1.11</em>) memory limit in bytes</li>
<li><strong>memorySwap</strong> (<em>v1.11</em>) total memory usage (memory + swap); use -1 to disable swap.</li>
<li><strong>namingStrategy</strong> sets the name of the container<ul>
<li><code>none</code> : uses randomly assigned names from docker (default)</li>
<li><code>alias</code> : uses the <code>alias</code> specified in the <code>image</code> configuration. An error is thrown, if a container already exists
with this name.</li>
</ul>
</li>
<li><strong>portPropertyFile</strong>, if given, specifies a file into which the
mapped properties should be written to. The format of this file and
its purpose are also described <a href="#port-mapping">below</a></li>
<li><strong>ports</strong> declares how container exposed ports should be
mapped. This is described below in an extra
<a href="#port-mapping">section</a>.  </li>
<li><strong>privileged</strong> (<em>v1.11</em>) give container full access to host (<code>true|false</code>)   </li>
<li><strong>restartPolicy</strong> (<em>v1.15</em>) specifies the container restart policy, see 
<a href="#container-restart-policy">below</a></li>
<li><strong>user</strong> (<em>v1.11</em>) user used inside the container</li>
<li><strong>skip</strong> disable creating and starting of the container. This option is best used together with a configuration option.</li>
<li><strong>volumes</strong> for bind configurtion of host directories and from other containers. See &quot;[Volume binding]
(#volume-binding)&quot; for details.</li>
<li><strong>wait</strong> specifies condition which must be fulfilled for the startup
to complete. See <a href="#wait-during-startup-and-shutdown">below</a> which subelements are
available and how they can be specified.</li>
<li><strong>workingDir</strong> (<em>v1.11</em>) working dir for commands to run in</li>
</ul>
<p>Example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">run</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">env</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">CATALINA_OPTS</span>&gt;</span>-Xmx32m<span class="hljs-tag">&lt;/<span class="hljs-title">CATALINA_OPTS</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">JOLOKIA_OFF</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">env</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">labels</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">environment</span>&gt;</span>development<span class="hljs-tag">&lt;/<span class="hljs-title">environment</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">labels</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">ports</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>jolokia.port:8080<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">ports</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">links</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span>&gt;</span>db<span class="hljs-tag">&lt;/<span class="hljs-title">db</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">links</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">wait</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">http</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">url</span>&gt;</span>http://localhost:${jolokia.port}/jolokia<span class="hljs-tag">&lt;/<span class="hljs-title">url</span>&gt;</span>    
    <span class="hljs-tag">&lt;/<span class="hljs-title">http</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">time</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-title">time</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">wait</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">log</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">prefix</span>&gt;</span>DEMO<span class="hljs-tag">&lt;/<span class="hljs-title">prefix</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">date</span>&gt;</span>ISO8601<span class="hljs-tag">&lt;/<span class="hljs-title">date</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">color</span>&gt;</span>blue<span class="hljs-tag">&lt;/<span class="hljs-title">color</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">log</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">cmd</span>&gt;</span>java -jar /maven/docker-demo.jar<span class="hljs-tag">&lt;/<span class="hljs-title">cmd</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">run</span>&gt;</span>
</code></pre>
<h5 id="setting-environment-variables-and-labels"><a name="setting-environment-variables-and-labels" class="plugin-anchor" href="#setting-environment-variables-and-labels"><span class="fa fa-link"></span></a>Setting environment variables and labels</h5>
<p>When creating a container one or more environment variables can be set
via configuration with the <code>env</code> parameter </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">env</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">JAVA_HOME</span>&gt;</span>/opt/jdk8<span class="hljs-tag">&lt;/<span class="hljs-title">JAVA_HOME</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">CATALINA_OPTS</span>&gt;</span>-Djava.security.egd=file:/dev/./urandom<span class="hljs-tag">&lt;/<span class="hljs-title">CATALINA_OPTS</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">env</span>&gt;</span>
</code></pre>
<p>If you put this configuration into profiles you can easily create
various test variants with a single image (e.g. by
switching the JDK or whatever).</p>
<p>It is also possible to set the environment variables from the outside of the plugin&apos;s 
configuration with the parameter <code>envPropertyFile</code>. If given, this property file
is used to set the environment variables where the keys and values specify the environment variable. 
Environment variables specified in this file override any environment variables specified in the configuration.</p>
<p>Labels can be set inline the same way as environment variables:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">labels</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">com.example.label-with-value</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-title">com.example.label-with-value</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>${project.artifactId}<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">labels</span>&gt;</span>
</code></pre>
<h5 id="port-mapping"><a name="port-mapping" class="plugin-anchor" href="#port-mapping"><span class="fa fa-link"></span></a>Port Mapping</h5>
<p>The <code>&lt;ports&gt;</code> configuration contains a list of port mappings. Each
mapping has multiple parts, each separate by a colon. This is
equivalent to the port mapping when using the Docker CLI with option
<code>-p</code>. </p>
<p>A <code>port</code> stanza may take one of the following forms:</p>
<ul>
<li><strong>18080:8080</strong> : A tuple consisting of two numeric values separated by a <code>:</code>. This 
form will result in an explicit mapping between the docker host and the corresponding 
port inside the container. In the above example, port 18080 would be exposed on the 
docker host and mapped to port 8080 in the running container. </li>
<li><strong>host.port:80</strong> A tuple consisting of a string and a numeric value separated by a
<code>:</code>. In this form, the string portion of the tuple will correspond
to a Maven property. If the property is undefined when the <code>start</code>
task executes, a port will be dynamically selected by Docker in the
ephemeral port range and assigned to the property which may then be
used later in the same POM file. The ephemeral port range is configured
by the <code>/proc/sys/net/ipv4/ip_local_port_range</code> kernel parameter, which
typically ranges from 32678 to 61000.  If the property exists and has a
numeric value, that value will be used as the exposed port on the
docker host as in the previous form. In the above example, the
docker service will elect a new port and assign the value to the
property <code>host.port</code> which may then later be used in a property
expression similar to <code>&lt;value&gt;${host.port}&lt;/value&gt;</code>. This can be
used to pin a port from the outside when doing some initial testing
similar to <code>mvn -Dhost.port=10080 docker:start</code></li>
<li><strong>&lt;bindTo&gt;:host.port:80</strong> A tuple consisting of two strings and a numeric value separated
by a <code>:</code>. In this form, <code>&lt;bindTo&gt;</code> is an ip address on the host the container should bind to.
As a convenience, a hostname pointing to the docker host may also
be specified. The container will fail to start if the hostname can not be 
resolved.  </li>
<li><strong>+host.ip:host.port:80</strong> A tuple consisting of two strings and a numeric value separated
by a <code>:</code>. In this form, the host ip of the container will be placed into a Maven property.
If docker reports that value to be <code>0.0.0.0</code>, the value of <code>docker.host.address</code> will
be substituted instead. In the event you want to use this form and have the container bind 
to a specific hostname/ip address, you can declare a Maven property of the same name and correct
value to use. <code>host:post</code> functions in the same manner as described above. </li>
</ul>
<p>The following are examples of valid configuration entries:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bind.host.ip</span>&gt;</span>1.2.3.4<span class="hljs-tag">&lt;/<span class="hljs-title">bind.host.ip</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bind.host.name</span>&gt;</span>some.host.pvt<span class="hljs-tag">&lt;/<span class="hljs-title">bind.host.name</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">properties</span>&gt;</span>

...

<span class="hljs-tag">&lt;<span class="hljs-title">ports</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>18080:8080<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>host.port:80<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>127.0.0.1:80:80<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>localhost:host.port:80<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>+container.ip.property:host.port:5678<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>+bind.host.ip:host.port:5678<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>+bind.host.name:5678:5678<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ports</span>&gt;</span>
</code></pre>
<p>Another useful configuration option is <code>portPropertyFile</code> which can be used to
to write out the container&apos;s host ip and any dynamic ports that have been
resolved. The keys of this property file are the property names defined in the 
port mapping configuration and their values those of the corresponding 
docker attributes. </p>
<p>This property file might be useful with tests or with other maven plugins that will be unable 
to use the resolved properties because they can only be updated after the container has started
and plugins resolve their properties in an earlier lifecycle phase.</p>
<p>If you don&apos;t need to write out such a property file and thus don&apos;t need to preserve the property names, 
you can use normal maven properties as well. E.g. <code>${host.var}:${port.var}:8080</code> instead of 
<code>+host.var:port.var:8080</code>.  </p>
<h5 id="container-linking"><a name="container-linking" class="plugin-anchor" href="#container-linking"><span class="fa fa-link"></span></a>Container linking</h5>
<p>The <code>&lt;links&gt;</code> configuration contains a list of containers that should
be linked to this container according to
<a href="https://docs.docker.com/userguide/dockerlinks/" target="_blank">Docker Links</a>. Each
link can have two parts where the optional right side is separated by
a <code>:</code> and will be used as the name in the environment variables and
the left side refers to the name of the container linking to. This is
equivalent to the linking when using the Docker CLI <code>--link</code> option.</p>
<p>Example for linking to a container with name or alias <em>postgres</em> :</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">links</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span>&gt;</span>postgres:db<span class="hljs-tag">&lt;/<span class="hljs-title">link</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">links</span>&gt;</span>
</code></pre>
<p>This will create the following environment variables, given that the
postgres image exposes TCP port 5432: </p>
<pre><code>DB_NAME=/web2/db
DB_PORT=tcp://172.17.0.5:5432
DB_PORT_5432_TCP=tcp://172.17.0.5:5432
DB_PORT_5432_TCP_PROTO=tcp
DB_PORT_5432_TCP_PORT=5432
DB_PORT_5432_TCP_ADDR=172.17.0.5
</code></pre><p>If you wish to link to existing containers not managed by the plugin, you may do so by specifying the container name
obtained via <code>docker ps</code> in the configuration.</p>
<h5 id="volume-binding"><a name="volume-binding" class="plugin-anchor" href="#volume-binding"><span class="fa fa-link"></span></a>Volume binding</h5>
<p>A container can bind (or &quot;mount&quot;) volumes from various source when starting up: Either from a directory of
the host system or from another container which exports one or more directories. The mount configuration is
specified within a <code>&lt;volumes&gt;</code> section of the run configuration. It can contain the following sub elements:</p>
<ul>
<li><strong>from</strong> can contain a list of <code>&lt;image&gt;</code> elements which specify
image names or aliases of containers whose volumes should be imported.</li>
<li><strong>bind</strong> can contain a list of <code>&lt;volume&gt;</code> specifications (or <em>host mounts</em>). Use <code>/path</code> to create and
expose a new volume in the container, <code>/host_path:/container_path</code> to mount a host path into the
container and <code>/host_path:/container_path:ro</code> to bind it read-only.</li>
</ul>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">volumes</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bind</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">volume</span>&gt;</span>/logs<span class="hljs-tag">&lt;/<span class="hljs-title">volume</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">volume</span>&gt;</span>/opt/host_export:/opt/container_import<span class="hljs-tag">&lt;/<span class="hljs-title">volume</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bind</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">from</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">image</span>&gt;</span>jolokia/docker-demo<span class="hljs-tag">&lt;/<span class="hljs-title">image</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">from</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">volumes</span>&gt;</span>
</code></pre>
<p>In this example the container creates a new volume named  <code>/logs</code> on the container and mounts <code>/opt/host_export</code> from
the host as <code>/opt/container_import</code> on the container. In addition all exported volumes from the container which has
been created from the image <code>jolokia/docker-demo</code> are mounted directly into the container (with the same name as
the exporting container exposes these directories). The image must be also configured for this plugin. Instead of
the full image name, an alias name like <em>service</em> can be used, too.</p>
<p>Please note, that no relative paths are allowed. However, you can use Maven variables in the path specifications. This
should even work for boot2docker:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">volumes</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bind</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">volume</span>&gt;</span>${project.build.directory}/${project.artifactId}-${project.version}:/usr/local/tomcat/webapps/${project.name}<span class="hljs-tag">&lt;/<span class="hljs-title">volume</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-title">volume</span>&gt;</span>${project.basedir}/data:/data<span class="hljs-tag">&lt;/<span class="hljs-title">volume</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bind</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">volumes</span>&gt;</span>
</code></pre>
<p>If you wish to mount volumes from an existing container not managed by the plugin, you may do by specifying the container name
obtained via <code>docker ps</code> in the configuration.</p>
<h5 id="container-restart-policy"><a name="container-restart-policy" class="plugin-anchor" href="#container-restart-policy"><span class="fa fa-link"></span></a>Container restart policy</h5>
<p>Specify the behavior to apply when the container exits. These values can be
specified withing a <code>&lt;restartPolicy&gt;</code> section with the following sub-elements:</p>
<ul>
<li><strong>name</strong> restart policy name, choose from:<ul>
<li><code>always</code> (<em>v1.15</em>) always restart</li>
<li><code>on-failure</code> (<em>v1.15</em>) restart on container non-exit code of zero</li>
</ul>
</li>
<li><strong>retry</strong> if <code>on-failure</code> is used, controls max number of attempts to 
restart before giving up.</li>
</ul>
<p>The behavior to apply when the container exits. The value is an object with a Name 
property of either &quot;always&quot; to always restart or &quot;on-failure&quot; to restart only when the 
container exit code is non-zero. If on-failure is used, MaximumRetryCount controls the
 number of times to retry before giving up. The default is not to restart. (optional)</p>
<h5 id="wait-during-startup-and-shutdown"><a name="wait-during-startup-and-shutdown" class="plugin-anchor" href="#wait-during-startup-and-shutdown"><span class="fa fa-link"></span></a>Wait during startup and shutdown</h5>
<p>While starting a container is it possible to block the execution until
some condition is met. These conditions can be specified within a
<code>&lt;wait&gt;</code> section which the following sub-elements:</p>
<ul>
<li><strong>http</strong> specifies an HTTP ping check which periodically polls an URL. It knows the following sub-elements:<ul>
<li><strong>url</strong> holds an URL and is mandatory</li>
<li><strong>method</strong> Optional HTTP method to use.</li>
<li><strong>status</strong> Status code which if returned is considered to be a successful ping. This code can be given either as 
a single number (200) or as a range (200..399). The default is <code>200..399</code></li>
</ul>
</li>
<li><strong>log</strong> is a regular expression which is applied against the log
output of an container and blocks until the pattern is matched.</li>
<li><strong>time</strong> is the time in milliseconds to block.</li>
<li><strong>kill</strong> is the time in milliseconds between sending SIGTERM and SIGKILL when stopping a container. Since docker itself
uses second granularity, you should use at least 1000 milliseconds.</li>
<li><strong>shutdown</strong> is the time to wait in milliseconds between stopping a container
and removing it. This might be helpful in situation where a Docker croaks with an
error when trying to remove a container to fast after it has been stopped.</li>
<li><strong>exec</strong> Specifies commands to execute during specified lifecycle of the container. It knows the following sub-elements:<ul>
<li><strong>postStart</strong> Command to run after the above wait criteria has been met</li>
<li><strong>preStop</strong> Command to run before the container is stopped.</li>
</ul>
</li>
</ul>
<p>As soon as one condition is met the build continues. If you add a
<code>&lt;time&gt;</code> constraint this works more or less as a timeout for other
conditions. The build will abort if you wait on an url or log output and reach the timeout. 
If only a <code>&lt;time&gt;</code> is specified, the build will wait that amount of milliseconds and then continues.</p>
<p>Example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">wait</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">http</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url</span>&gt;</span>http://localhost:${host.port}<span class="hljs-tag">&lt;/<span class="hljs-title">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">method</span>&gt;</span>GET<span class="hljs-tag">&lt;/<span class="hljs-title">method</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>200..399<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">http</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">time</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-title">time</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kill</span>&gt;</span>1000<span class="hljs-tag">&lt;/<span class="hljs-title">kill</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">shutdown</span>&gt;</span>500<span class="hljs-tag">&lt;/<span class="hljs-title">shutdown</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">exec</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">postStart</span>&gt;</span>/opt/init_db.sh<span class="hljs-tag">&lt;/<span class="hljs-title">postStart</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">preStop</span>&gt;</span>/opt/notify_end.sh<span class="hljs-tag">&lt;/<span class="hljs-title">preStop</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">exec</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">wait</span>&gt;</span>
</code></pre>
<p>This setup will wait for the given URL to be reachable but ten seconds
at most. Also, when stopping the container after an integration tests, the
build wait for 500 ms before it tries to remove the container (if not <code>keepContainer</code>
or <code>keepRunning</code> is used). You can use maven properties in each
condition, too. In the example, the <code>${host.port}</code> property is
probably set before within a port mapping section. </p>
<p>The property <code>${docker.host.address}</code> is set implicitly to the address of the Docker host. This host will 
be taken from the <code>docker.host</code> configuration if HTTP or HTTPS is used. If a Unix socket is used for communication
with the docker daemon, then <code>localhost</code> is assumed. You can override this property always by setting this Maven 
property explicitly. </p>
<h5 id="log-configuration"><a name="log-configuration" class="plugin-anchor" href="#log-configuration"><span class="fa fa-link"></span></a>Log configuration</h5>
<p>When running containers the standard output and standard error of the
container can be printed out. Several options are available for
configuring the log output:</p>
<ul>
<li><strong>enabled</strong> If given and set to <code>false</code> log output is disabled. This
is useful if you want to disable log output by default but want to
use the other configuration options when log output is switched on
on the command line with <code>-Ddocker.showLogs</code>. Logging is enabled by
default if a <code>&lt;log&gt;</code> section is given.</li>
<li><strong>prefix</strong> Prefix to use for the log output in order to identify the
container. By default the image <code>alias</code> is used or alternatively the
container <code>id</code>. </li>
<li><strong>date</strong> Dateformat to use for log timestamps. If <code>&lt;date&gt;</code> is not
given no timestamp will be shown. The date specification can be
either a constant or a date format. The recognized constants are:<ul>
<li><code>NONE</code> Switch off timestamp output. Useful on the command line
(<code>-Ddocker.logDate=NONE</code>) for switching off otherwise enabled
logging. </li>
<li><code>DEFAULT</code> A default format in the form <code>HH:mm:ss.SSS</code></li>
<li><code>MEDIUM</code> Joda medium date time format</li>
<li><code>SHORT</code> Joda short date time format</li>
<li><code>LONG</code> Joda long date time format</li>
<li><code>ISO8601</code> Full ISO-8601 formatted date time with milli seconds
As an alternative a date-time format string as recognized by
<a href="http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html" target="_blank">JodaTime</a>
is possible. In order to set a consistent date format 
the global configuration parameter <code>logDate</code> can be used.</li>
</ul>
</li>
<li><strong>color</strong> Color used for coloring the prefix when coloring is enabeld
(i.e. if running in a console and <code>useColor</code> is set). The available
colors are <code>YELLOW</code>, <code>CYAN</code>, <code>MAGENTA</code>, <code>GREEN</code>, <code>RED</code>, <code>BLUE</code>. If
coloring is enabled and now color is provided a color is picked for
you. </li>
<li><strong>file</strong> Path to a file to which the log output is written. This file is overwritten 
for every run and colors are switched off. </li>
</ul>
<p>Example (values can be case insensitive, too) :</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">log</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">prefix</span>&gt;</span>TC<span class="hljs-tag">&lt;/<span class="hljs-title">prefix</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">date</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-title">date</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">color</span>&gt;</span>cyan<span class="hljs-tag">&lt;/<span class="hljs-title">color</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">log</span>&gt;</span>
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./docker-build.html" class="navigation navigation-prev " aria-label="Previous page: docker:build"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./docker-stop.html" class="navigation navigation-next " aria-label="Next page: docker:stop"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"edit-link":{"base":"https://github.com/rhuss/docker-maven-plugin/edit/master/doc/manual","label":"Edit This Page"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
