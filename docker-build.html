<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>docker:build | docker-maven-plugin</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./docker-start.html" />
    
    
    <link rel="prev" href="./goals.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="4.1"
        data-chapter-title="docker:build"
        data-filepath="docker-build.md"
        data-basepath="."
        data-revision="Wed Apr 27 2016 21:38:51 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="installation.html">
            
                
                    <a href="./installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Installation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="global-configuration.html">
            
                
                    <a href="./global-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Global Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="image-configuration.html">
            
                
                    <a href="./image-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Image Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="goals.html">
            
                
                    <a href="./goals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Maven Goals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="4.1" data-path="docker-build.html">
            
                
                    <a href="./docker-build.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        docker:build
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="docker-start.html">
            
                
                    <a href="./docker-start.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        docker:start
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="docker-stop.html">
            
                
                    <a href="./docker-stop.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        docker:stop
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="docker-watch.html">
            
                
                    <a href="./docker-watch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        docker:watch
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="docker-push.html">
            
                
                    <a href="./docker-push.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        docker:push
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="docker-remove.html">
            
                
                    <a href="./docker-remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        docker:remove
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="docker-logs.html">
            
                
                    <a href="./docker-logs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        docker:logs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="docker-source.html">
            
                
                    <a href="./docker-source.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        docker:source
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="external-configuration.html">
            
                
                    <a href="./external-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        External Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="registry-handling.html">
            
                
                    <a href="./registry-handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Registry Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="authentication.html">
            
                
                    <a href="./authentication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="links.html">
            
                
                    <a href="./links.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Further Reading
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >docker-maven-plugin</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h3 id="dockerbuild"><a name="dockerbuild" class="plugin-anchor" href="#dockerbuild"><span class="fa fa-link"></span></a>docker:build</h3>
<p>This goal will build all images which have a <code>&lt;build&gt;</code> configuration
section, or, if the global configuration variable <code>image</code> (property:
<code>docker.image</code>) is set, only the images contained in this variable
(comma separated) will be built.</p>
<p>Image can be build in two different ways:</p>
<ul>
<li><strong>Inline plugin configuration</strong> with everything specified with the POM. </li>
<li><strong>External Dockerfiles</strong> which can be enriched by build information.</li>
</ul>
<h4 id="inline-plugin-configuration"><a name="inline-plugin-configuration" class="plugin-anchor" href="#inline-plugin-configuration"><span class="fa fa-link"></span></a>Inline plugin configuration</h4>
<p>Here all configurartion required to build the image is contained in
the plugin configuration. By default its the standard XML based
configuration for the plugin but can be switched to a property based
configuration syntax as described in the section
<a href="external-configuration.html">External configuration</a>. The XML
configuration syntax is reqcommended because of its more structured
and typed nature. </p>
<p>When using this mode, the Dockerfile is created on the fly with all
instructions extracted from the configuration given. </p>
<h4 id="external-dockerfile"><a name="external-dockerfile" class="plugin-anchor" href="#external-dockerfile"><span class="fa fa-link"></span></a>External Dockerfile</h4>
<p>Alternatively an external Dockerfile template can be used. This mode
is switch on by using one of these two configuration options within
the <code>&lt;build&gt;</code> configuration section.</p>
<ul>
<li><p><strong>dockerFileDir</strong> specifies a directory containing a
<code>Dockerfile</code> that will be used to create the image. </p>
</li>
<li><p><strong>dockerFile</strong> specifies a specific Dockerfile. The <code>dockerFileDir</code>
is set to the directory containing the file.</p>
</li>
</ul>
<p>If <code>dockerFileDir</code> is a relative path looked up in
<code>${project.basedDir}/src/main/docker</code>. You can make easily an absolute
path by prefixing with <code>${project.baseDir}</code>.</p>
<p>Any additional files located in the <code>dockerFileDir</code> directory will
also be added to the build context as well as any files specified by
an assembly. However, you still need to insert <code>ADD</code> or <code>COPY</code>
directives yourself into the Dockerfile. If this directory contains a
<code>.maven-dockerignore</code> file, then it is used for excluding files for
the build. Each line in this file is treated as an
<a href="http://ant.apache.org/manual/Types/fileset.html" target="_blank">FileSet exclude pattern</a>
as used by the <a href="http://maven.apache
.org/plugins/maven-assembly-plugin/" target="_blank">maven-assembly-plugin</a>. It is similar to <code>.dockerignore</code>
when using Docker but has a slightly different syntax (hence the
different name).</p>
<p>Except for the <a href="#build-assembly">assembly configuration</a> all other
configuration options are ignored for now. For the future it is
planned to introduce special keywords lile <code>DMP_ADD_ASSEMBLY</code> which
can be used in the Dockerfile template to placing the configuration
resulting from the additional configuration.</p>
<p>The following example used a Dockerfile in the directory
<code>src/main/docker/demo</code>: </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">images</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">image</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>user/demo<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">dockerFileDir</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">dockerFileDir</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">image</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">images</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
 ...
<span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
</code></pre>
<h4 id="configuration"><a name="configuration" class="plugin-anchor" href="#configuration"><span class="fa fa-link"></span></a>Configuration</h4>
<p>All build relevant configuration is contained in the <code>&lt;build&gt;</code> section
of an image configuration. In addition to <code>&lt;dockerFileDir&gt;</code> and
<code>&lt;dockerFile&gt;</code> the following configuration options are available:</p>
<ul>
<li><strong>args</strong> is Map specifying the value of <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg" target="_blank">Docker build args</a> 
which should be used when building the image with an external Dockerfile which uses build arguments. 
The key-value syntax is the same as when defining Maven properties (or <code>labels</code> or <code>env</code>). 
This argument is ignored when no external Dockerfile is used. Build args can also be specified as properties as 
described in <a href="#build-args">Build Args</a></li>
<li><strong>assembly</strong> specifies the assembly configuration as described in
<a href="#build-assembly">Build Assembly</a></li>
<li><strong>cleanup</strong> Cleanup dangling (untagged) images after each build (including any containers
created from them). Default is <code>try</code> which tries to remove the old image, but doesn&apos;t fail the build if this
is not possible because e.g. the image is still used by a running container. Use <code>remove</code> if you want to fail
the build and <code>none</code> if no cleanup is requested.</li>
<li><strong>nocache</strong> Don&apos;t use Docker&apos;s build cache. This can be overwritten by setting a system property <code>docker.nocache</code>
when running Maven.</li>
<li><strong>cmd</strong> A command to execute by default (i.e. if no command
is provided when a container for this image is started). See 
<a href="#startup-arguments">Start-up Arguments</a> for details.</li>
<li><strong>entryPoint</strong> An entrypoint allows you to configure a container that will run as an executable. 
See <a href="#startup-arguments">Start-up Arguments</a> for details.</li>
<li><strong>env</strong> holds environments as described in
<a href="docker-start.html#setting-environment-variables-and-labels">Setting Environment Variables and Labels</a>.</li>
<li><strong>from</strong> specifies the base image which should be used for this
image. If not given this default to <code>busybox:latest</code> and is suitable
for a pure data image.</li>
<li><strong>labels</strong> holds labels  as described in
<a href="#setting-environment-variables-and-labels">Setting Environment Variables and Labels</a>. </li>
<li><strong>maintainer</strong> specifies the author (MAINTAINER) field for the generated image</li>
<li><strong>ports</strong> describes the exports ports. It contains a list of
<code>&lt;port&gt;</code> elements, one for each port to expose.</li>
<li><strong>runCmds</strong> specifies commands to be run during the build process. It contains <strong>run</strong> elements 
which are passed to bash. The run commands are inserted right after the assembly and after <strong>workdir</strong> in to the
Dockerfile. This tag is not to be confused with the <code>&lt;run&gt;</code> section for this image which specifies the runtime
behaviour when starting containers.  </li>
<li><strong>optimise</strong> if set to true then it will compress all the <code>runCmds</code> into a single RUN directive so that only one image layer is created.</li>
<li><strong>compression</strong> is the compression mode how the build archive is transmitted to the docker daemon (<code>docker:build</code>) and how 
docker build archives are attached to this build as sources (<code>docker:source</code>). The value can be <code>none</code> (default), 
<code>gzip</code> or <code>bzip2</code>. </li>
<li><strong>skip</strong> if set to true disables building of the image. This config option is best used together with a maven property</li>
<li><strong>tags</strong> contains a list of additional <code>tag</code> elements with which an
image is to be tagged after the build.</li>
<li><strong>volumes</strong> contains a list of <code>volume</code> elements to create a container
volume.</li>
<li><strong>workdir</strong> the directory to change to when starting the container.</li>
</ul>
<p>From this configuration this Plugin creates an in-memory Dockerfile,
copies over the assembled files and calls the Docker daemon via its
remote API. </p>
<p>Here&apos;s an example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">from</span>&gt;</span>java:8u40<span class="hljs-tag">&lt;/<span class="hljs-title">from</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">maintainer</span>&gt;</span>john.doe@example.com<span class="hljs-tag">&lt;/<span class="hljs-title">maintainer</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">tags</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">tag</span>&gt;</span>latest<span class="hljs-tag">&lt;/<span class="hljs-title">tag</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">tag</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-title">tag</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">tags</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">ports</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-title">port</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">ports</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">volumes</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">volume</span>&gt;</span>/path/to/expose<span class="hljs-tag">&lt;/<span class="hljs-title">volume</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">volumes</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">entryPoint</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- exec form for ENTRYPOINT --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">exec</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>-jar<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>/opt/demo/server.jar<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">exec</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">entryPoint</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">assembly</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">mode</span>&gt;</span>dir<span class="hljs-tag">&lt;/<span class="hljs-title">mode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">basedir</span>&gt;</span>/opt/demo<span class="hljs-tag">&lt;/<span class="hljs-title">basedir</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">descriptor</span>&gt;</span>assembly.xml<span class="hljs-tag">&lt;/<span class="hljs-title">descriptor</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">assembly</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span>
</code></pre>
<h5 id="build-assembly"><a name="build-assembly" class="plugin-anchor" href="#build-assembly"><span class="fa fa-link"></span></a>Build Assembly</h5>
<ul>
<li><strong>basedir</strong> depicts the directory under which the files and
artifacts contained in the assembly will be copied within the
container. The default value for this is <code>/maven</code>.</li>
<li><strong>inline</strong> inlined assembly descriptor as
described in the section <a href="#docker-assembly">Docker Assembly</a> below. </li>
<li><strong>descriptor</strong> is a reference to an assembly descriptor as
described in the section <a href="#docker-assembly">Docker Assembly</a> below. </li>
<li><strong>descriptorRef</strong> is an alias to a predefined assembly
descriptor. The available aliases are also described in the
<a href="#docker-assembly">Docker Assembly</a> section.</li>
<li><strong>dockerFileDir</strong> specifies a directory containing an external
Dockerfile. <strong>This option is deprecated, please use <dockerfiledir>
directly in the <build> section. See above for the usage.</build></dockerfiledir></strong> </li>
<li><strong>exportBasedir</strong> indicates if the <code>basedir</code> should be exported as a volume.
This value is <code>true</code> by default except in the case the <code>basedir</code> is set to 
the container root (<code>/</code>). It is also <code>false</code> by default when a base image is used with <code>from</code> 
since exporting makes no sense in this case and will waste disk space unnecessarily.    </li>
<li><strong>ignorePermissions</strong> indicates if existing file permissions should be ignored
when creating the assembly archive. This value is <code>false</code> by default.</li>
<li><strong>mode</strong> specifies how the assembled files should be collected. By default the files a simply
copied (<code>dir</code>), but can be set to be a Tar- (<code>tar</code>), compressed Tar- (<code>tgz</code>) or Zip- (<code>zip</code>) Archive. 
The archive formats have the advantage that file permission can be preserved better (since the copying is 
independent from the underlying files systems), but might triggers internal bugs from the Maven assembler (as 
it has been in #171)</li>
<li><strong>user</strong> can be used to specify the user and group under which the files should be added. The user must be already exist in 
the base image. It has the general format 
<code>user[:group[:run-user]]</code>. The user and group can be given either as numeric user- and group-id or as names. The group 
id is optional. If a third part is given, then the build changes to user <code>root</code> before changing the ownerships, 
changes the ownerships and then change to user <code>run-user</code> which is then used for the final command to execute. This feature
might be needed, if the base image already changed the user (e.g. to &apos;jboss&apos;) so that a <code>chown</code> from root to this user would fail. 
For example, the image <code>jboss/wildfly</code> use a &quot;jboss&quot; user under which all commands are executed. Adding files in Docker
always happens under the UID root. These files can only be changed to &quot;jboss&quot; is the <code>chown</code> command is executed as root. 
For the following commands to be run again as &quot;jboss&quot; (like the final <code>standalone.sh</code>), the plugin switches back to 
user <code>jboss</code> (this is this &quot;run-user&quot;) after changing the file ownership. For this example a specification of 
<code>jboss:jboss:jboss</code> would be required. </li>
</ul>
<p>In the event you do not need to include any artifacts with the image, you may
safely omit this element from the configuration.</p>
<h5 id="startup-arguments"><a name="startup-arguments" class="plugin-anchor" href="#startup-arguments"><span class="fa fa-link"></span></a>Start-up Arguments</h5>
<p>Using <code>entryPoint</code> and <code>cmd</code> it is possible to specify the <a href="https://docs.docker.com/reference/builder/#entrypoint" target="_blank">entry point</a> 
or <a href="https://docs.docker.com/reference/builder/#cmd" target="_blank">cmd</a> for a container.</p>
<p>The difference is, that an <code>entrypoint</code> is the command that always be executed, with the <code>cmd</code> as argument.
If no <code>entryPoint</code> is provided, it defaults to <code>/bin/sh -c</code> so any <code>cmd</code> given is executed 
with a shell. The arguments given to <code>docker run</code> are always given as arguments to the 
<code>entrypoint</code>, overriding any given <code>cmd</code> option. On the other hand if no extra arguments
are given to <code>docker run</code> the default <code>cmd</code> is used as argument to <code>entrypoint</code>. See also
this <a href="http://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile" target="_blank">stackoverflow question</a>
for an even more detailed explanation.</p>
<p>A entry point or command can be specified in two alternative formats:</p>
<ul>
<li><strong>shell</strong> shell form in which the whole line is given to <code>shell -c</code> for interpretation.</li>
<li><strong>exec</strong> list of arguments (with inner <code>&lt;args&gt;</code>) arguments which will be given to the <code>exec</code> call directly without any shell interpretation. </li>
</ul>
<p>Either shell or params should be specified. </p>
<p>Example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">entryPoint</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- shell form  --&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">shell</span>&gt;</span>java -jar $HOME/server.jar<span class="hljs-tag">&lt;/<span class="hljs-title">shell</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">entryPoint</span>&gt;</span>
</code></pre>
<p>or </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">entryPoint</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- exec form  --&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">exec</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">args</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-title">args</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">args</span>&gt;</span>-jar<span class="hljs-tag">&lt;/<span class="hljs-title">args</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">args</span>&gt;</span>/opt/demo/server.jar<span class="hljs-tag">&lt;/<span class="hljs-title">args</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">exec</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">entryPoint</span>&gt;</span>
</code></pre>
<p>This can be formulated also more dense with:</p>
<pre><code class="lang-xml"><span class="hljs-comment">&lt;!-- shell form  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">entryPoint</span>&gt;</span>java -jar $HOME/server.jar<span class="hljs-tag">&lt;/<span class="hljs-title">entryPoint</span>&gt;</span>
</code></pre>
<p>or </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">entryPoint</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- exec form  --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>-jar<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">arg</span>&gt;</span>/opt/demo/server.jar<span class="hljs-tag">&lt;/<span class="hljs-title">arg</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">entryPoint</span>&gt;</span>
</code></pre>
<h5 id="docker-assembly"><a name="docker-assembly" class="plugin-anchor" href="#docker-assembly"><span class="fa fa-link"></span></a>Docker Assembly</h5>
<p>With using the <code>inline</code>, <code>descriptor</code> or <code>descriptorRef</code> option
it is possible to bring local files, artifacts and dependencies into
the running Docker container. A <code>descriptor</code> points to a file
describing the data to put into an image to build. It has the same
<a href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html" target="_blank">format</a>
as for creating assemblies with the
<a href="http://maven.apache.org/plugins/maven-assembly-plugin/" target="_blank">maven-assembly-plugin</a>
with following exceptions:</p>
<ul>
<li><code>&lt;formats&gt;</code> are ignored, the assembly will allways use a directory
when preparing the data container (i.e. the format is fixed to
<code>dir</code>) </li>
<li>The <code>&lt;id&gt;</code> is ignored since only a single assembly descriptor is
used (no need to distinguish multiple descriptors) </li>
</ul>
<p>Also you can inline the assembly description with a <code>inline</code> description 
directly into the pom file. Adding the proper namespace even allows for 
IDE autocompletion. As an example, refer to the profile <code>inline</code> in 
the <code>data-jolokia-demo</code>&apos;s pom.xml. </p>
<p>Alternatively <code>descriptorRef</code> can be used with the name of a
predefined assembly descriptor. The following symbolic names can be
used for <code>descriptorRef</code>:</p>
<ul>
<li><strong>artifact-with-dependencies</strong> will copy your project&apos;s artifact and
all its dependencies. Also, when a <code>classpath</code> file exists in the target 
directory, this will be added to.</li>
<li><strong>artifact</strong> will copy only the project&apos;s artifact but no
dependencies. </li>
<li><strong>project</strong> will copy over the whole Maven project but with out
<code>target/</code> directory. </li>
<li><strong>rootWar</strong> will copy the artifact as <code>ROOT.war</code> to the exposed
directory. I.e. Tomcat will then deploy the war under the root
context. </li>
</ul>
<p>For example, </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">images</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">image</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">assembly</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">descriptorRef</span>&gt;</span>artifact-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-title">descriptorRef</span>&gt;</span>
         .....
</code></pre>
<p>will add the created artifact with the name <code>${project.build.finalName}.${artifact.extension}</code>
and all jar dependencies in the the <code>baseDir</code> (which is <code>/maven</code> by default).</p>
<p>All declared files end up in the configured <code>basedir</code> (or <code>/maven</code>
by default) in the created image.</p>
<p>If the assembly references the artifact to build with this pom, it is 
required that the <code>package</code> phase is included in the run. This happens 
either automatically when the <code>docker:build</code> target is called as part 
of a binding (e.g. is <code>docker:build</code> is bound to the <code>pre-integration-test</code> 
phase) or it must be ensured when called on the command line:</p>
<pre><code class="lang-bash">mvn package docker:build
</code></pre>
<p>This is a general restriction of the Maven lifecycle which applies also 
for the <code>maven-assembly-plugin</code> itself.</p>
<p>In the following example a dependency from the pom.xml is included and
mapped to the name <code>jolokia.war</code>. With this configuration you will end
up with an image, based on <code>busybox</code> which has a directory <code>/maven</code>
containing a single file <code>jolokia.war</code>. This volume is also exported
automatically. </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">assembly</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependencySets</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependencySet</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">includes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>org.jolokia:jolokia-war<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">includes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">outputDirectory</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-title">outputDirectory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">outputFileNameMapping</span>&gt;</span>jolokia.war<span class="hljs-tag">&lt;/<span class="hljs-title">outputFileNameMapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependencySet</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencySets</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">assembly</span>&gt;</span>
</code></pre>
<p>Another container can now connect to the volume an &apos;mount&apos; the 
<code>/maven</code> directory. A container  from <code>consol/tomcat-7.0</code> will look
into <code>/maven</code> and copy over everything to <code>/opt/tomcat/webapps</code> before
starting Tomcat.</p>
<p>If you are using the <code>artifact</code> or <code>artifact-with-dependencies</code> descriptor, it is
possible to change the name of the final build artifact with the following:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">finalName</span>&gt;</span>your-desired-final-name<span class="hljs-tag">&lt;/<span class="hljs-title">finalName</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span>
</code></pre>
<p>Please note, based upon the following documentation listed <a href="http://maven.apache.org/pom.html#BaseBuild_Element" target="_blank">here</a>,
there is no guarantee the plugin creating your artifact will honor it in which case you will need to use a custom
descriptor like above to achieve the desired naming.</p>
<p>Currently the <code>jar</code> and <code>war</code> plugins properly honor the usage of <code>finalName</code>.</p>
<h4 id="build-args"><a name="build-args" class="plugin-anchor" href="#build-args"><span class="fa fa-link"></span></a>Build Args</h4>
<p>As described in section <a href="#configuration">Configuration</a> for external Dockerfiles <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg" target="_blank">Docker build arg</a> can be used. In addition to the 
configuration within the plugin configuration you can also use properties to specify them:</p>
<ul>
<li><p>Set a system property when running Maven, eg.: <code>-Ddocker.buildArg.http_proxy=http://proxy:8001</code>. This is especially
useful when using predefined Docker arguments for setting proxies transparently.</p>
</li>
<li><p>Set a project property within the <code>pom.xml</code>, eg.:</p>
<pre><code>  &lt;docker.buildArg.myBuildArg&gt;myValue&lt;/docker.buildArg.myBuildArg&gt;
</code></pre></li>
</ul>
<p>Please note that the system property setting will always override the project property. Also note that for all
properties which are not Docker <a href="https://docs.docker.com/engine/reference/builder/#arg" target="_blank">predefined</a> properties, 
the external Dockerfile must contain an <code>ARGS</code> instruction. </p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./goals.html" class="navigation navigation-prev " aria-label="Previous page: Maven Goals"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./docker-start.html" class="navigation navigation-next " aria-label="Next page: docker:start"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/code-tomorrow-scheme.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-code_tomorrow_scheme/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/fabric8io/docker-maven-plugin/edit/master/doc/manual","label":"Edit This Page"},"anchors":{},"code_tomorrow_scheme":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
